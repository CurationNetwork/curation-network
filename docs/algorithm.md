# Token curated dApp ranking

### Постановка задачи
Спроектировать систему позволяющую построить честный рейтинг по какому-либо критерию, и полностью управляемый сообществом с помощью токенов. Система должна быть устойчива ко всевозможным видам атак с целью манипулирования рейтингом, а так же к стратегиям получения прибыли без участия в улучшении рейтинга. А так же немаловажным требованием к системе является мотивация всех типов пользователей к участию в составлении рейтинга.

### Основые идеи
 - Для листинга в рейтинг используем алгоритм TCR.
 - Процесс изменения рейтинга - скрытое голосование, но факт проведения голосование за конкретный dApp публичный. Сила голоса - размер стейка, можно голосовать за понижение или за повышение рейтинга.
 - Одновременно за dApp может проводиться только одно голосование. Инициирует его первый кто решил проголосовать за dApp.
 - Голосование продолжается некоторое количесво времени.
 - За участие в голосовании взымается комиссия независимо от исхода голосования.
 - Размер комиссии зависит от текущего рейтинга dApp, а так же от силы голоса.
 - Комиссия относительно силы голоса растет линейно пока она меньше некоторого глобального органичения, а затем экспоненциально, это сопротивление системы на резкие изменения.
 - У каждого dApp есть баланс, который суммуруется в призовой фонд голосования.
 - Стейк после окончания голосования возвращается обратно владельцу. В случае победы постепенно,  а в случае поражения - сразу.
 - Победитель голосования получает выигрыш пропорционально силе своего голоса от суммы всех комиссий за это голосование, а так же из баланса dApp.
 - Все глобальные органичения и параметры зависят от общего состояния системы. Строго задаются лишь начальные значения.


### Голосование
Любой участник всегда может принять участие в открытом голосовании или инициировать новое если за этот dApp на текущий момент нету голосования.

#### Формальное описание
##### Используемые обозначения
> - ![](https://latex.codecogs.com/svg.latex?C_{f}) - фиксированная часть комиссии.
> - ![](https://latex.codecogs.com/svg.latex?C_{d,i}) - динамическая часть комиссии для *i*-го участника за еденицу токена.
> - ![](https://latex.codecogs.com/svg.latex?S_{i}) - сила голоса *i*-го участника голосования.
> - ![](https://latex.codecogs.com/svg.latex?F_{t}) - общий призовой фонд.
> - ![](https://latex.codecogs.com/svg.latex?F_{s}) - стимулирующий баланс dApp.

##### Алгоритм
> 1. Пользователь инициирует новое голосование, коммитит силу своего голоса, направление, и отправляет фиксированную часть комиссии в размере ![](https://latex.codecogs.com/svg.latex?C_{f}) токенов.
> 2. Другие пользователи видят открытое голосование и могут присоединиться таким же образом как и в п. 1
> 3. Голосование заканчивается через ![](https://latex.codecogs.com/svg.latex?V_{t}) секунд.
> 4. Каждый участник раскрывает свой голос, а так же замораживает ![](https://latex.codecogs.com/svg.latex?S_{i}) токенов и отправляет динамическую часть комиссии равную ![](https://latex.codecogs.com/svg.latex?C_{d}) токенов.
> 5. Вычисляется сумма голосов ![](https://latex.codecogs.com/svg.latex?S_{up}) - за повышение рейтинга и ![](https://latex.codecogs.com/svg.latex?S_{down}) - за понижение. 
> 6. Если ![](https://latex.codecogs.com/svg.latex?S_{up}>S_{down}) рейтинг dApp повышается на ![](https://latex.codecogs.com/svg.latex?(S_{up}-S_{down})), иначе понижается на ![](https://latex.codecogs.com/svg.latex?(S_{down}-S_{up})).
> 7. Участники проголосовавшие за победившее направление получают вознаграждение в размере ![](https://latex.codecogs.com/svg.latex?P_i=\frac{F_t*S_i}{\sum_{i=1}^{k}{S_{i}}}), где ![](https://latex.codecogs.com/svg.latex?F_t=\sum_{i=1}^{k}{(C_{f,i}+C_{d,i})}+F_s).
> 8. Размораживается стейк у проигравших, у победителей стейк будет размораживаться постепенно.

*Формулы для расчета комиссий описаны в разделе "Глобальные параметры".* 


### Разморозка стейка
После окончания голосования stake победителей постепенно размораживается. Такой механизм позволяет реализовать концепцию: не работающие токены не приносят прибыли. Тем самым увеличивает оборот токенов, что повышает его ценность. А так же это мотивирует кураторов активно участвовать в составлении рейтинга и защищает от наплыва пассивных держателей токенов.

#### Формальное описание
##### Используемые обозначения
> - ![](https://latex.codecogs.com/svg.latex?E) - глобальный параметр отвечающий за скорость разморозки стейка.
> - ![](https://latex.codecogs.com/svg.latex?S(t)) - кол-во размороженного стейка в момент времени *t*.
> - ![](https://latex.codecogs.com/svg.latex?t_s) - время окончания голосования.
> - ![](https://latex.codecogs.com/svg.latex?S_{i}) - сила голоса *i*-го участника голосования.
> - ![](https://latex.codecogs.com/svg.latex?S_{r,i}) - кол-во уже размороженного стейка *i*-го участника голосования.

##### Алгоритм
> 1. Закончивается голосование, устанавливается ![](https://latex.codecogs.com/svg.latex?t_s=now) и ![](https://latex.codecogs.com/svg.latex?S_{r,i}=0)
> 2. Пользователь делает запрос на разморозку стейка
> 3. Если ![](https://latex.codecogs.com/svg.latex?now>(t_s+S_i/E)), то у пользователя размораживается стейк размером ![](https://latex.codecogs.com/svg.latex?S_i-S_{r,i}) и устанавливается ![](https://latex.codecogs.com/svg.latex?S_{r,i}=S_i), иначе п. 4
> 4. У пользователя размораживается стейк размером ![](https://latex.codecogs.com/svg.latex?E*(now-t_s)-S_{r,i}) и устанавливается ![](https://latex.codecogs.com/svg.latex?S_{r,i}=E*(now-t_s))


### Глобальные параментры
В системе присутствуют глобальные органичения и параметры, все они динамически изменяются в зависимости от общего состояния системы.

##### Комиссия за голосование
Комиссия вычисляется динамически в зависимости от силы голоса и рейтинга dApp.

Комиссия состоит из двух частей:
 1. Первая часть (![](https://latex.codecogs.com/svg.latex?C_f)) которая зависит от только рейтинга dApp и оплачивается в начале голосования.
 2. Вторая часть (![](https://latex.codecogs.com/svg.latex?C_d)) которая зависит от силы голоса и оплачивается после окончания голосования.

Разделение нужно для того чтобы по размеру комисии нельзя было вычислить силу голоса.

###### Расчет первой части
![](https://latex.codecogs.com/svg.latex?C_{f,j}=())
//TODO

###### Расчет второй части
![](https://latex.codecogs.com/svg.latex?C_{d,j}=())
//TODO

### Скорость разморозки стейка
Скорость растет пропорционально росту количества голосований. Но не может быть больше скорости при которой система не успевает отреагировать на изменения. Для определения этой скорости введем понятие минимального времени (![](https://latex.codecogs.com/svg.latex?T_{min})) за которое размораживается стейк размер которого равен среднему из всех стейков, это ограничение имеет естественную природу, т.к например при ![](https://latex.codecogs.com/svg.latex?T_{min}) меньшем чем время между блоками в блокчейне система переходит от динамической к статической.

##### Расчет
![](https://latex.codecogs.com/svg.latex?E=E_0+atan(\frac{T_{min}*count_v}{avg\(S_i\)})*\frac{avg(S_i)}{T_{min}})

![](https://latex.codecogs.com/svg.latex?E_0) - начальное значение скорости
![](https://latex.codecogs.com/svg.latex?avg(S_i)) - среднее из всех стейков
![](https://latex.codecogs.com/svg.latex?count_v) - количество голосований за предыдущие сутки
